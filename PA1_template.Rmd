---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---
## Set global variables
```r{set envionments}
library(knitr)

opts_chunk$set(echo=TRUE, results='asis')
```

## Loading and preprocessing the data
```r{set working directory, echo = FALSE}

setwd("Z:/Coursera/Data Science/05 - Repoducible Research/Week 2/Project 1/RepData_PeerAssessment1")

```

```r{read csv file, echo = TRUE}
if(!file.exists('activity.csv')){
    unzip('activity.zip')
}
activity <- read.csv('activity.csv')

activity$date <- as.Date(activity$date, "%Y-%m-%d")
```


## What is mean total number of steps taken per day?
```r{mean of total number of steps}
total.steps <- with(activity,tapply(steps, date, sum, na.rm=TRUE))
total.mean <- mean(total.steps)
total.median <- median(total.steps)
library(ggplot2)
qplot(total.steps, xlab='Total steps', ylab='Frequency', binwidth=1000) +
geom_vline(xintercept = total.mean, colour="red") + 
geom_text(aes(x=total.mean, label="\nMean", y=1), colour="red", angle=90, text=element_text(size=12)) +
geom_vline(xintercept = total.median, colour="green") +
geom_text(aes(x=total.median, label="\nMedian", y=1), colour="green", angle=90, text=element_text(size=12)) 

```


## What is the average daily activity pattern?
```r{average daily activity pattern}
average.steps <- with(activity,tapply(steps, interval, mean, na.rm=TRUE))

plot(row.names(average.steps), average.steps, type = "l", xlab = "5-min interval", ylab = "Average across all Days", main = "Average number of steps taken", col = "red")

max.interval <- as.numeric(names(which.max(average.steps)))
abline(v=max.interval,col="blue")
mtext(side=3,line=-2,adj=1," -- Max Interval",col="blue")
```

## Imputing missing values

# How many missing
```r{missing steps}
activity.missing <- sum(is.na(activity))

library(Hmisc)
activity.filled <- activity
activity.filled$steps <- with(activity.filled, impute(steps, mean))


total.filled.steps <- with(activity.filled,tapply(steps, date, sum, na.rm=TRUE))
total.filled.mean <- mean(total.filled.steps)
total.filled.median <- median(total.filled.steps)
library(ggplot2)
qplot(total.filled.steps, xlab='Total steps', ylab='Frequency', binwidth=1000) +
geom_vline(xintercept = total.filled.mean, colour="red") + 
geom_text(aes(x=total.filled.mean, label="\nMean", y=10), colour="red", angle=90, text=element_text(size=12)) +
geom_vline(xintercept = total.filled.median, colour="green") +
geom_text(aes(x=total.filled.median, label="\nMedian", y=1), colour="green", angle=90, text=element_text(size=12)) 

```

## Are there differences in activity patterns between weekdays and weekends?
day.type <- function(date) {
    if (weekdays(date) %in% c('Saturday', 'Sunday')) {
        return('weekend')
    } else {
        return('weekday')
    }
}

day.types <- sapply(activity.filled$date, day.type)
activity.filled$daytype <- as.factor(day.types)

averages <- aggregate(steps ~ interval + daytype, data=activity.filled, mean)

ggplot(averages, aes(interval, steps)) + geom_line(aes(color=daytype)) + facet_grid(daytype ~ .) + xlab("5-minute interval") + ylab("Number of steps")
